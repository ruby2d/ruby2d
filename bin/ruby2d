#!/usr/bin/env ruby

require 'ruby2d/cli/colorize'
require 'ruby2d/version'

# Debugging command-line flag
@debug = false

# Usage ########################################################################

usage = "Ruby 2D: Make cross-platform 2D applications in Ruby".bold + "\n
Usage: ruby2d <command> <options>
              [-v|--version]

Summary of commands and options:
  build         Compile a Ruby source file on available plaforms
    --assets      Include a directory containing media assets
    --debug       Print debugging info and save files generated
    --clean       Cleans the build directory
  serve         Start a local server and open a built web app
  -v|--version  Prints the installed version\n\n"


# Check Command-line Arguments #################################################

def get_flag(flag)
  flag_index = ARGV.find_index flag
  return nil unless flag_index
  val = ARGV[flag_index + 1]
  ARGV.delete flag
  return '' unless val
  ARGV.delete val
  val
end

case ARGV[0]
when 'build'
  require 'ruby2d/cli/build'
  if ARGV.delete '--debug' then @debug = true end
  if ARGV[1] == '--clean'
    clean_up(:all)
  else
    assets_dir = get_flag '--assets'
    build(ARGV[1], assets_dir)
  end
when 'serve'
  require 'ruby2d/cli/build'
  serve(ARGV[1])
when '-v', '--version'
  puts Ruby2D::VERSION
else
  puts usage
end
